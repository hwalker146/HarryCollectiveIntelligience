{% extends "base.html" %}

{% block title %}Settings - Podcast Analysis v2{% endblock %}

{% block content %}
<div x-data="settingsPage()" x-init="loadSettings()">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">
            <i class="fas fa-cog mr-3 text-indigo-600"></i>
            Account Settings
        </h1>
        <p class="mt-2 text-gray-600">Manage your account preferences, API settings, and data.</p>
    </div>

    <!-- Settings Navigation -->
    <div class="mb-8">
        <div class="sm:hidden">
            <select @change="currentTab = $event.target.value" class="block w-full rounded-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                <option value="profile">Profile</option>
                <option value="notifications">Notifications</option>
                <option value="privacy">Privacy</option>
                <option value="api">API & Integrations</option>
                <option value="data">Data Management</option>
            </select>
        </div>
        <div class="hidden sm:block">
            <nav class="flex space-x-8" aria-label="Tabs">
                <button @click="currentTab = 'profile'" 
                        :class="currentTab === 'profile' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-user mr-1"></i>
                    Profile
                </button>
                
                <button @click="currentTab = 'notifications'" 
                        :class="currentTab === 'notifications' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-bell mr-1"></i>
                    Notifications
                </button>
                
                <button @click="currentTab = 'privacy'" 
                        :class="currentTab === 'privacy' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-shield-alt mr-1"></i>
                    Privacy
                </button>
                
                <button @click="currentTab = 'api'" 
                        :class="currentTab === 'api' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-plug mr-1"></i>
                    API & Integrations
                </button>
                
                <button @click="currentTab = 'data'" 
                        :class="currentTab === 'data' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-database mr-1"></i>
                    Data Management
                </button>
            </nav>
        </div>
    </div>

    <!-- Profile Tab -->
    <div x-show="currentTab === 'profile'" class="space-y-6">
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">Profile Information</h2>
                
                <form @submit.prevent="saveProfile()">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                            <input x-model="profile.name" type="text" id="name" 
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                            <input x-model="profile.email" type="email" id="email" 
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label for="timezone" class="block text-sm font-medium text-gray-700">Timezone</label>
                            <select x-model="profile.timezone" id="timezone" 
                                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                <option value="America/New_York">Eastern Time (ET)</option>
                                <option value="America/Chicago">Central Time (CT)</option>
                                <option value="America/Denver">Mountain Time (MT)</option>
                                <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                <option value="Europe/London">London (GMT)</option>
                                <option value="Europe/Paris">Paris (CET)</option>
                                <option value="Asia/Tokyo">Tokyo (JST)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button type="submit" :disabled="loading" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50">
                            <span x-show="!loading">Save Profile</span>
                            <span x-show="loading" class="flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                Saving...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Password Change -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">Change Password</h2>
                
                <form @submit.prevent="changePassword()">
                    <div class="space-y-4">
                        <div>
                            <label for="current-password" class="block text-sm font-medium text-gray-700">Current Password</label>
                            <input x-model="passwordForm.current_password" type="password" id="current-password" 
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label for="new-password" class="block text-sm font-medium text-gray-700">New Password</label>
                            <input x-model="passwordForm.new_password" type="password" id="new-password" 
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label for="confirm-password" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                            <input x-model="passwordForm.confirm_password" type="password" id="confirm-password" 
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button type="submit" :disabled="loading" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50">
                            <span x-show="!loading">Change Password</span>
                            <span x-show="loading" class="flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                Updating...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notifications Tab -->
    <div x-show="currentTab === 'notifications'" class="space-y-6">
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">Notification Preferences</h2>
                
                <form @submit.prevent="saveNotifications()">
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-sm font-medium text-gray-900 mb-3">Email Notifications</h3>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input x-model="notifications.email.new_episodes" type="checkbox" 
                                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                    <span class="ml-2 text-sm text-gray-700">New episode analysis available</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input x-model="notifications.email.weekly_digest" type="checkbox" 
                                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                    <span class="ml-2 text-sm text-gray-700">Weekly knowledge digest</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input x-model="notifications.email.insights_summary" type="checkbox" 
                                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                    <span class="ml-2 text-sm text-gray-700">Monthly insights summary</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-sm font-medium text-gray-900 mb-3">System Notifications</h3>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input x-model="notifications.system.subscription_errors" type="checkbox" 
                                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                    <span class="ml-2 text-sm text-gray-700">Subscription errors</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input x-model="notifications.system.account_security" type="checkbox" 
                                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                    <span class="ml-2 text-sm text-gray-700">Account security alerts</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button type="submit" :disabled="loading" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50">
                            <span x-show="!loading">Save Preferences</span>
                            <span x-show="loading" class="flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                Saving...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Privacy Tab -->
    <div x-show="currentTab === 'privacy'" class="space-y-6">
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">Privacy Settings</h2>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-3">Data Processing</h3>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input x-model="privacy.analytics" type="checkbox" 
                                       class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <span class="ml-2 text-sm text-gray-700">Allow usage analytics to improve the service</span>
                            </label>
                            
                            <label class="flex items-center">
                                <input x-model="privacy.data_retention" type="checkbox" 
                                       class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <span class="ml-2 text-sm text-gray-700">Keep analysis data for service improvements</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-3">Data Sharing</h3>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input x-model="privacy.anonymized_insights" type="checkbox" 
                                       class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <span class="ml-2 text-sm text-gray-700">Share anonymized insights for research</span>
                            </label>
                        </div>
                        <p class="mt-2 text-xs text-gray-500">All shared data is completely anonymized and cannot be traced back to your account.</p>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button @click="savePrivacy()" :disabled="loading" 
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50">
                        <span x-show="!loading">Save Privacy Settings</span>
                        <span x-show="loading" class="flex items-center">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            Saving...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Tab -->
    <div x-show="currentTab === 'api'" class="space-y-6">
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">API Configuration</h2>
                
                <div class="space-y-6">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4">
                        <div class="flex">
                            <i class="fas fa-exclamation-triangle text-yellow-400 mt-0.5 mr-2"></i>
                            <div>
                                <p class="text-sm text-yellow-700">
                                    <strong>Note:</strong> These API keys are used for transcription and analysis. Keep them secure and never share them.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label for="openai-key" class="block text-sm font-medium text-gray-700">OpenAI API Key</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input x-model="apiKeys.openai" :type="showOpenAI ? 'text' : 'password'" id="openai-key" 
                                   class="flex-1 block w-full border-gray-300 rounded-l-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                   placeholder="sk-...">
                            <button @click="showOpenAI = !showOpenAI" type="button" 
                                    class="inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-500 hover:bg-gray-100">
                                <i :class="showOpenAI ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                            </button>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">Used for podcast transcription via Whisper API</p>
                    </div>
                    
                    <div>
                        <label for="anthropic-key" class="block text-sm font-medium text-gray-700">Anthropic API Key</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input x-model="apiKeys.anthropic" :type="showAnthropic ? 'text' : 'password'" id="anthropic-key" 
                                   class="flex-1 block w-full border-gray-300 rounded-l-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                   placeholder="sk-ant-...">
                            <button @click="showAnthropic = !showAnthropic" type="button" 
                                    class="inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-500 hover:bg-gray-100">
                                <i :class="showAnthropic ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                            </button>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">Used for AI-powered episode analysis</p>
                    </div>
                </div>
                
                <div class="mt-6 flex items-center space-x-4">
                    <button @click="saveAPIKeys()" :disabled="loading" 
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50">
                        <span x-show="!loading">Save API Keys</span>
                        <span x-show="loading" class="flex items-center">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            Saving...
                        </span>
                    </button>
                    
                    <button @click="testAPIKeys()" :disabled="loading" 
                            class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50">
                        <i class="fas fa-vial mr-2"></i>
                        Test Connection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Management Tab -->
    <div x-show="currentTab === 'data'" class="space-y-6">
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">Data Management</h2>
                
                <div class="space-y-6">
                    <!-- Export Data -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-3">Export Your Data</h3>
                        <p class="text-sm text-gray-600 mb-4">Download a complete archive of your podcast analysis data, knowledge base entries, and settings.</p>
                        
                        <button @click="exportData()" :disabled="loading" 
                                class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50">
                            <i class="fas fa-download mr-2"></i>
                            <span x-show="!loading">Export Data</span>
                            <span x-show="loading">Preparing Export...</span>
                        </button>
                    </div>
                    
                    <!-- Clear Cache -->
                    <div class="border-t border-gray-200 pt-6">
                        <h3 class="text-sm font-medium text-gray-900 mb-3">Clear Cache</h3>
                        <p class="text-sm text-gray-600 mb-4">Clear cached transcripts and analysis data to free up storage space. This won't affect your knowledge base.</p>
                        
                        <button @click="clearCache()" :disabled="loading" 
                                class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50">
                            <i class="fas fa-broom mr-2"></i>
                            Clear Cache
                        </button>
                    </div>
                    
                    <!-- Delete Account -->
                    <div class="border-t border-gray-200 pt-6">
                        <div class="bg-red-50 border border-red-200 rounded-md p-4">
                            <div class="flex">
                                <i class="fas fa-exclamation-triangle text-red-400 mt-0.5 mr-2"></i>
                                <div>
                                    <h3 class="text-sm font-medium text-red-800 mb-2">Delete Account</h3>
                                    <p class="text-sm text-red-700 mb-4">
                                        Permanently delete your account and all associated data. This action cannot be undone.
                                    </p>
                                    <button @click="showDeleteConfirm = true" 
                                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                        <i class="fas fa-trash mr-2"></i>
                                        Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div x-show="showDeleteConfirm" x-cloak class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div x-show="showDeleteConfirm" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <div x-show="showDeleteConfirm" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100" x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                Delete Account
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">
                                    Are you sure you want to delete your account? This will permanently remove all your data, including:
                                </p>
                                <ul class="text-sm text-gray-500 mt-2 list-disc list-inside">
                                    <li>All podcast subscriptions</li>
                                    <li>Analysis reports and transcripts</li>
                                    <li>Knowledge base entries</li>
                                    <li>Personal notes and settings</li>
                                </ul>
                                <p class="text-sm text-gray-500 mt-2">
                                    This action cannot be undone.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="deleteAccount()" :disabled="loading" 
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50">
                        <span x-show="!loading">Delete Account</span>
                        <span x-show="loading" class="flex items-center">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            Deleting...
                        </span>
                    </button>
                    <button @click="showDeleteConfirm = false" type="button" 
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function settingsPage() {
    return {
        currentTab: 'profile',
        loading: false,
        showDeleteConfirm: false,
        showOpenAI: false,
        showAnthropic: false,
        
        // Data
        profile: {
            name: '',
            email: '',
            timezone: 'America/New_York'
        },
        
        passwordForm: {
            current_password: '',
            new_password: '',
            confirm_password: ''
        },
        
        notifications: {
            email: {
                new_episodes: true,
                weekly_digest: true,
                insights_summary: false
            },
            system: {
                subscription_errors: true,
                account_security: true
            }
        },
        
        privacy: {
            analytics: true,
            data_retention: true,
            anonymized_insights: false
        },
        
        apiKeys: {
            openai: '',
            anthropic: ''
        },
        
        async loadSettings() {
            this.loading = true;
            
            try {
                // In a real app, these would be API calls to load user settings
                this.profile = {
                    name: 'John Doe',
                    email: 'john@example.com',
                    timezone: 'America/New_York'
                };
                
                // API keys would be partially masked when loaded
                this.apiKeys = {
                    openai: 'sk-...masked',
                    anthropic: 'sk-ant-...masked'
                };
                
            } catch (error) {
                PodcastApp.showNotification('Failed to load settings', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async saveProfile() {
            this.loading = true;
            
            try {
                // In a real app, this would save to backend
                PodcastApp.showNotification('Profile updated successfully', 'success');
                
            } catch (error) {
                PodcastApp.showNotification('Failed to update profile', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async changePassword() {
            if (this.passwordForm.new_password !== this.passwordForm.confirm_password) {
                PodcastApp.showNotification('Passwords do not match', 'error');
                return;
            }
            
            this.loading = true;
            
            try {
                // In a real app, this would update password
                PodcastApp.showNotification('Password changed successfully', 'success');
                this.passwordForm = {
                    current_password: '',
                    new_password: '',
                    confirm_password: ''
                };
                
            } catch (error) {
                PodcastApp.showNotification('Failed to change password', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async saveNotifications() {
            this.loading = true;
            
            try {
                // In a real app, this would save notification preferences
                PodcastApp.showNotification('Notification preferences saved', 'success');
                
            } catch (error) {
                PodcastApp.showNotification('Failed to save preferences', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async savePrivacy() {
            this.loading = true;
            
            try {
                // In a real app, this would save privacy settings
                PodcastApp.showNotification('Privacy settings saved', 'success');
                
            } catch (error) {
                PodcastApp.showNotification('Failed to save privacy settings', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async saveAPIKeys() {
            this.loading = true;
            
            try {
                // In a real app, this would securely save API keys
                PodcastApp.showNotification('API keys saved successfully', 'success');
                
            } catch (error) {
                PodcastApp.showNotification('Failed to save API keys', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async testAPIKeys() {
            this.loading = true;
            
            try {
                // In a real app, this would test API connectivity
                PodcastApp.showNotification('API keys are working correctly', 'success');
                
            } catch (error) {
                PodcastApp.showNotification('API key test failed. Please check your keys.', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async exportData() {
            this.loading = true;
            
            try {
                // In a real app, this would generate and download export file
                const exportData = {
                    profile: this.profile,
                    subscriptions: [],
                    knowledge_base: [],
                    analysis_reports: [],
                    exported_at: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `podcast_analysis_export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                PodcastApp.showNotification('Data exported successfully', 'success');
                
            } catch (error) {
                PodcastApp.showNotification('Failed to export data', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async clearCache() {
            if (!confirm('Are you sure you want to clear the cache? This will remove cached transcripts and may require re-processing some episodes.')) {
                return;
            }
            
            this.loading = true;
            
            try {
                // In a real app, this would clear cached data
                PodcastApp.showNotification('Cache cleared successfully', 'success');
                
            } catch (error) {
                PodcastApp.showNotification('Failed to clear cache', 'error');
            } finally {
                this.loading = false;
            }
        },
        
        async deleteAccount() {
            this.loading = true;
            
            try {
                // In a real app, this would delete the account
                PodcastApp.showNotification('Account deleted successfully', 'success');
                
                // Redirect to homepage after a delay
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);
                
            } catch (error) {
                PodcastApp.showNotification('Failed to delete account', 'error');
            } finally {
                this.loading = false;
                this.showDeleteConfirm = false;
            }
        }
    }
}
</script>
{% endblock %}